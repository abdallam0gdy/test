<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุงูุงูุชุญุงู V3 (ุณุฏ ุงูุซุบุฑุงุช)</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f4f4f4; height: 100vh; overflow: hidden; user-select: none; }
        .container { display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column; text-align: center; }
        
        #start-screen { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        #exam-screen { display: none; width: 100%; height: 100%; background: white; padding: 20px; box-sizing: border-box; }
        
        /* ุดุงุดุฉ ุงููุฎุงููุฉ */
        #warning-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #d32f2f; color: white; flex-direction: column; justify-content: center; align-items: center; z-index: 99999; text-align: center; }
        
        button { padding: 12px 25px; font-size: 16px; margin: 10px; cursor: pointer; border: none; border-radius: 5px; color: white; transition: 0.3s; }
        .btn-blue { background: #007bff; }
        .btn-green { background: #28a745; display: none; } /* ูุฎูู ูุญุฏ ูุง ููุนู ุงูุงุดุนุงุฑุงุช */
        .btn-red { background: transparent; border: 2px solid white; }
        
        .alert-box { background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; font-size: 0.9em; margin-bottom: 10px; border: 1px solid #ffeeba; }
    </style>
</head>
<body>

    <div id="start-screen" class="container">
        <h1>๐ ูุธุงู ุงูุงูุชุญุงู ุงููุคูู</h1>
        <div class="alert-box">
            ูุฌุจ ุฅุบูุงู ุฃู ููุงูุฐ ููุจุซูุฉ ุฃู ุชูุณูู ููุดุงุดุฉ <b>ูุจู</b> ุงูุจุฏุก.
        </div>
        
        <button onclick="requestNotifyPermission()" id="notifyBtn" class="btn-blue">๐ ุงูุฎุทูุฉ 1: ุชูุนูู ุงูุฅุดุนุงุฑุงุช</button>
        <p id="notifyStatus" style="font-size: 12px; color: gray;"></p>

        <button onclick="attemptStart()" id="startBtn" class="btn-green">๐ ุงูุฎุทูุฉ 2: ุงุจุฏุฃ ุงูุงูุชุญุงู</button>
    </div>

    <div id="exam-screen">
        <div style="background: #333; color: #0f0; padding: 10px; border-radius: 5px;">
            โ ุงููุธุงู ุขูู ููุนูู
        </div>
        <h3>ุฃุณุฆูุฉ ุงูุงูุชุญุงู:</h3>
        <p>ุญุงูู ุงูุขู ุชูุณูู ุงูุดุงุดุฉ ุฃู ุงูุฎุฑูุฌ...</p>
        <textarea style="width: 100%; height: 150px; border: 2px solid #ddd; padding: 10px; font-size: 18px;" placeholder="ุงูุชุจ ุงูุฅุฌุงุจุฉ ููุง..."></textarea>
    </div>

    <div id="warning-overlay">
        <h1 style="font-size: 3em;">โ ูุฎุงููุฉ!</h1>
        <h2 id="violation-reason" style="background: rgba(0,0,0,0.2); padding: 5px 15px;"></h2>
        <p>ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุฑุงูุจ.</p>
        <button class="btn-red" onclick="resumeExam()">ุชุตุญูุญ ุงููุถุน ูุงูุนูุฏุฉ</button>
    </div>

    <script>
        const startScreen = document.getElementById('start-screen');
        const examScreen = document.getElementById('exam-screen');
        const warningOverlay = document.getElementById('warning-overlay');
        const notifyBtn = document.getElementById('notifyBtn');
        const startBtn = document.getElementById('startBtn');
        const notifyStatus = document.getElementById('notifyStatus');

        let isExamActive = false;

        // 1. ุทูุจ ุงูุฅุฐู (ูุงุฒู ุนุดุงู ุงูุงุดุนุงุฑุงุช ุชุดุชุบู)
        function requestNotifyPermission() {
            if (!("Notification" in window)) {
                alert("ุฌูุงุฒู ูุง ูุฏุนู ุงูุฅุดุนุงุฑุงุช");
                return;
            }
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    notifyStatus.innerText = "ุชู ุงูุชูุนูู โ";
                    notifyStatus.style.color = "green";
                    notifyBtn.style.display = "none";
                    startBtn.style.display = "inline-block";
                    
                    // ุชุฌุฑุจุฉ ุฅุดุนุงุฑ ููุฑู ููุชุฃูุฏ
                    new Notification("ุชู ุชูุนูู ูุธุงู ุงููุฑุงูุจุฉ", { body: "ุฌุงูุฒ ููุจุฏุก" });
                } else {
                    notifyStatus.innerText = "ุชู ุงูุฑูุถ โ. ุงุถุบุท ุนูู ุงูููู ุจุฌูุงุฑ ุงูุฑุงุจุท ูุชูุนูููุง.";
                    notifyStatus.style.color = "red";
                }
            });
        }

        // 2. ูุญุงููุฉ ุงูุจุฏุก (ุงููุญุต ุงููุณุจู ูุณุฏ ุงูุซุบุฑุฉ)
        function attemptStart() {
            // ุฃ) ูุญุต ุชูุณูู ุงูุดุงุดุฉ ุงููุณุจู (Initial Split Check)
            if (window.innerWidth < window.screen.width * 0.9) {
                alert("โ ุฎุทุฃ: ุฃูุช ุชุณุชุฎุฏู ุชูุณูู ุงูุดุงุดุฉ!\nูุฑุฌู ุฅุบูุงู ุงูุชุทุจููุงุช ุงูุฃุฎุฑู ูุชูุจูุฑ ุงููุชุตูุญ ุฃููุงู.");
                return; // ุงููุน ุงูุฏุฎูู
            }

            // ุจ) ูุญุต ุงูุชุฑููุฒ (ูู ูุงุชุญ ุดุงุดุฉ ููุจุซูุฉ ูุฏุงูุณ ุนูููุง)
            if (!document.hasFocus()) {
                alert("โ ุฎุทุฃ: ูุฑุฌู ุฅุบูุงู ุงูููุงูุฐ ุงูููุจุซูุฉ (Pop-up) ุฃููุงู.");
                return;
            }

            // ูู ุณูููุ ุงุทูุจ ุงูููู ุณูุฑูู
            document.documentElement.requestFullscreen().then(() => {
                startScreen.style.display = 'none';
                examScreen.style.display = 'block';
                isExamActive = true;
            }).catch(err => {
                alert("ูุฌุจ ุงูุณูุงุญ ุจููุก ุงูุดุงุดุฉ ููุนูู");
            });
        }

        // 3. ุฏุงูุฉ ุงูุงุณุชุฆูุงู
        function resumeExam() {
            // ูุงุฒู ูุฑุฌุน ููู ุณูุฑูู + ูุชุฃูุฏ ุฅูู ุตูุญ ุงููุถุน
            if (window.innerWidth < window.screen.width * 0.9) {
                alert("ูุงุฒุงูุช ุงูุดุงุดุฉ ููุณูุฉ! ูุจุฑูุง ุงูุฃูู.");
                return;
            }
            document.documentElement.requestFullscreen().then(() => {
                warningOverlay.style.display = 'none';
                examScreen.style.display = 'block';
            });
        }

        // 4. ุฅุฑุณุงู ุงูุฅุดุนุงุฑ (ูุน ุงูุชุฒุงุฒ)
        function sendViolationNotify(reason) {
            if (Notification.permission === "granted") {
                try {
                    navigator.vibrate([200, 100, 200]); // ุงูุชุฒุงุฒ ุงูููุจุงูู
                    new Notification("โ๏ธ ูุฎุงููุฉ ุงูุชุญุงู", {
                        body: "ุงูุณุจุจ: " + reason,
                        icon: "https://cdn-icons-png.flaticon.com/512/595/595067.png",
                        tag: "violation" // ุนุดุงู ููุธูุฑุด ุงุดุนุงุฑุงุช ูุชูุฑ ููู ุจุนุถ
                    });
                } catch(e) { console.log(e); }
            }
        }

        // 5. ูุธุงู ุงููุฑุงูุจุฉ (ูุนุฏู)
        function triggerViolation(reason) {
            if (!isExamActive) return;

            // ุฅุธูุงุฑ ุงูุดุงุดุฉ ุงูุญูุฑุงุก
            examScreen.style.display = 'none';
            warningOverlay.style.display = 'flex';
            document.getElementById('violation-reason').innerText = reason;
            
            sendViolationNotify(reason);
        }

        // --- ุงููุฑุงูุจูู ---

        // ูุดู ุชูุณูู ุงูุดุงุดุฉ (ูุณุชูุฑ)
        window.addEventListener('resize', () => {
            if (isExamActive) {
                // ูุงูุด 10% ุนุดุงู ุงุฎุชูุงู ุงูููุจุงููุงุช
                if (window.innerWidth < window.screen.width * 0.9) {
                    triggerViolation("ุชูุณูู ุงูุดุงุดุฉ ุฃุซูุงุก ุงูุงูุชุญุงู");
                }
            }
        });

        // ูุดู ุงูุฎุฑูุฌ (Tab Switching / Home Btn)
        document.addEventListener('visibilitychange', () => {
            if (isExamActive && document.hidden) {
                triggerViolation("ุงูุฎุฑูุฌ ูู ุงูุชุทุจูู");
            }
        });

        // ูุดู ุงูููุณ ุงูุฎุงุฑุฌู (Pop-up)
        window.addEventListener('blur', () => {
            if (isExamActive) {
                setTimeout(() => {
                    if (!document.hasFocus()) {
                        triggerViolation("ููุณ ูุงูุฐุฉ ุฎุงุฑุฌูุฉ");
                    }
                }, 200);
            }
        });

        // ูุดู ุงูุฎุฑูุฌ ูู Full Screen
        document.addEventListener('fullscreenchange', () => {
            if (isExamActive && !document.fullscreenElement) {
                triggerViolation("ุฅูุบุงุก ููุก ุงูุดุงุดุฉ");
            }
        });

    </script>
</body>
</html>
