<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ + Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f4f4f4; height: 100vh; overflow: hidden; user-select: none; }
        .container { display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column; }
        
        #start-screen { background: white; padding: 40px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 500px; }
        #exam-screen { display: none; width: 100%; height: 100%; background: white; padding: 20px; box-sizing: border-box; }
        #warning-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #d32f2f; color: white; flex-direction: column; justify-content: center; align-items: center; z-index: 99999; text-align: center; }
        
        button { padding: 15px 30px; font-size: 18px; margin-top: 10px; cursor: pointer; border: none; border-radius: 5px; color: white; background: #007bff; transition: 0.3s; }
        button:hover { background: #0056b3; }
        .btn-red { background: #ff4444; border: 2px solid white; }
    </style>
</head>
<body>

    <div id="start-screen" class="container">
        <h1>ğŸ”’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø°ÙƒÙŠ</h1>
        <p>ÙŠØ¬Ø¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆÙ…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©.</p>
        
        <button onclick="requestNotifyPermission()" id="notifyBtn">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø£ÙˆÙ„Ø§Ù‹</button>
        
        <button onclick="startExam()" id="startBtn" style="display: none; background: #28a745;">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
        
        <p id="statusMsg" style="color: gray; font-size: 12px; margin-top: 10px;"></p>
    </div>

    <div id="exam-screen">
        <div style="background: #333; color: white; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
            Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…: <span style="color: #0f0;">â— Ù…Ø±Ø§Ù‚Ø¨ ÙˆÙ†Ø´Ø·</span>
        </div>
        <h2>Ø³Ø¤Ø§Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ:</h2>
        <p>Ø¬Ø±Ø¨ ØªÙ„Ù…Ø³ Ø£ÙŠ Ø­Ø§Ø¬Ø© Ø¨Ø±Ù‡ Ø§Ù„Ù…ØªØµÙØ­ (Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©) Ø£Ùˆ ØªØ®Ø±Ø¬ Ø®Ø§Ù„Øµ.</p>
        <textarea style="width: 100%; height: 200px; font-size: 18px;" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§..."></textarea>
    </div>

    <div id="warning-overlay">
        <h1 style="font-size: 4em;">â›”</h1>
        <h1>ØªÙ… Ø±ØµØ¯ Ù…Ø®Ø§Ù„ÙØ©!</h1>
        <h2 id="violation-reason" style="color: yellow; background: rgba(0,0,0,0.3); padding: 5px 20px;"></h2>
        <p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØºØ´.</p>
        <button class="btn-red" onclick="resumeExam()">Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
    </div>

    <script>
        const startScreen = document.getElementById('start-screen');
        const examScreen = document.getElementById('exam-screen');
        const warningOverlay = document.getElementById('warning-overlay');
        const notifyBtn = document.getElementById('notifyBtn');
        const startBtn = document.getElementById('startBtn');
        const statusMsg = document.getElementById('statusMsg');

        let isExamActive = false;

        // 1. Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function requestNotifyPermission() {
            if (!("Notification" in window)) {
                alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
                return;
            }
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    statusMsg.innerText = "âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª";
                    statusMsg.style.color = "green";
                    notifyBtn.style.display = "none";
                    startBtn.style.display = "inline-block";
                } else {
                    statusMsg.innerText = "âŒ ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ø¨Ø¯Ø¡";
                    statusMsg.style.color = "red";
                }
            });
        }

        // 2. Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±
        function sendNotification(title, body) {
            if (Notification.permission === "granted") {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
                const notification = new Notification(title, {
                    body: body,
                    icon: "https://cdn-icons-png.flaticon.com/512/564/564619.png", // Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØ­Ø°ÙŠØ±
                    vibrate: [200, 100, 200] // Ø§Ù‡ØªØ²Ø§Ø² Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
                });
            }
        }

        // 3. Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function startExam() {
            document.documentElement.requestFullscreen().then(() => {
                startScreen.style.display = 'none';
                examScreen.style.display = 'block';
                isExamActive = true;
            }).catch(() => alert("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©"));
        }

        // 4. Ø§Ø³ØªØ¦Ù†Ø§Ù Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        function resumeExam() {
            document.documentElement.requestFullscreen().then(() => {
                warningOverlay.style.display = 'none';
                examScreen.style.display = 'block';
            });
        }

        // 5. Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
        function triggerViolation(reason) {
            if (!isExamActive) return;

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ù…Ø±Ø§Ø¡
            examScreen.style.display = 'none';
            warningOverlay.style.display = 'flex';
            document.getElementById('violation-reason').innerText = reason;

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙÙˆØ±Ø§Ù‹
            sendNotification("âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ", `ØªÙ… Ø±ØµØ¯ Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†: ${reason}`);
        }

        // --- Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ÙˆÙ† (The Watchers) ---

        // Ø£) ÙƒØ´Ù Ø§Ù„Ù„Ù…Ø³ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Pop-up View Touch)
        window.addEventListener('blur', () => {
            if (isExamActive) {
                // Ù†Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø© Ù„Ù†ØªØ£ÙƒØ¯ Ø£Ù†Ù‡ Ù„Ù…Ø³ Ø­Ù‚ÙŠÙ‚ÙŠ Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙØ­Ø©
                setTimeout(() => {
                    if (!document.hasFocus()) {
                        triggerViolation("Ù„Ù…Ø³ ØªØ·Ø¨ÙŠÙ‚ Ø®Ø§Ø±Ø¬ÙŠ (Pop-up)");
                    }
                }, 100);
            }
        });

        // Ø¨) ÙƒØ´Ù Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨ (Background)
        document.addEventListener('visibilitychange', () => {
            if (isExamActive && document.hidden) {
                triggerViolation("Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚/Ø§Ù„Ù…ØªØµÙØ­");
            }
        });

        // Ø¬) ÙƒØ´Ù ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø´Ø§Ø´Ø©
        window.addEventListener('resize', () => {
            if (isExamActive && window.innerWidth < window.screen.width * 0.9) {
                triggerViolation("ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø´Ø§Ø´Ø©");
            }
        });

        // Ø¯) ÙƒØ´Ù Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Full Screen
        document.addEventListener('fullscreenchange', () => {
            if (isExamActive && !document.fullscreenElement) {
                triggerViolation("Ø¥Ù„ØºØ§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©");
            }
        });

    </script>
</body>
</html>
