<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† V7 (Anti-Zoom)</title>
    <style>
        /* --- 1. Ø­Ø¸Ø± Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª (CSS Blocking) --- */
        body {
            margin: 0; font-family: 'Segoe UI', sans-serif; background: #f4f4f4; height: 100vh; overflow: hidden;
            user-select: none; -webkit-user-select: none; -webkit-touch-callout: none;
            
            /* Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ (Pinch) ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© */
            touch-action: pan-x pan-y; 
        }
        textarea, input { user-select: text; -webkit-user-select: text; }

        /* --- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª --- */
        .container { display: flex; justify-content: center; align-items: center; height: 100%; flex-direction: column; text-align: center; }
        #start-screen { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); position: relative; z-index: 1; }
        #exam-screen { display: none; width: 100%; height: 100%; background: white; padding: 20px; box-sizing: border-box; position: relative; overflow-y: auto; z-index: 1; }
        #warning-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #d32f2f; color: white; flex-direction: column; justify-content: center; align-items: center; z-index: 10003; text-align: center; }
        
        .watermark-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10002; opacity: 0.07; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); grid-template-rows: repeat(auto-fill, minmax(150px, 1fr)); overflow: hidden; }
        .watermark-item { display: flex; justify-content: center; align-items: center; transform: rotate(-30deg); font-weight: bold; font-size: 14px; color: #000; white-space: nowrap; }
        #toast-notification { position: fixed; top: -50px; left: 50%; transform: translateX(-50%); background: #d32f2f; color: white; padding: 10px 20px; border-radius: 0 0 10px 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 10004; transition: top 0.3s ease-in-out; font-weight: bold; }
        #toast-notification.show { top: 0; }
        
        button { padding: 12px 25px; margin: 10px; cursor: pointer; border: none; border-radius: 5px; color: white; transition: 0.3s; }
        .btn-blue { background: #007bff; } .btn-green { background: #28a745; display: none; } .btn-red { background: transparent; border: 2px solid white; }
    </style>
</head>
<body>

    <div id="toast-notification">âš ï¸ ØªÙ… Ø±ØµØ¯ Ù…Ø®Ø§Ù„ÙØ© Ø£Ù…Ù†ÙŠØ©!</div>
    <div class="watermark-container"></div>

    <div id="start-screen" class="container">
        <h1>ğŸ”’ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ù…Ø¤Ù…Ù† V7</h1>
        <p style="color:red; font-size: 0.9em;">ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙƒØ¨ÙŠØ± (Zoom) Ù„Ù…Ù†Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡.</p>
        <button onclick="requestNotifyPermission()" id="notifyBtn" class="btn-blue">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
        <p id="notifyStatus" style="font-size: 12px; color: gray;"></p>
        <button onclick="attemptStart()" id="startBtn" class="btn-green">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
    </div>

    <div id="exam-screen">
        <div style="background: #333; color: #0f0; padding: 10px; border-radius: 5px; position: relative;">
            â— Ø§Ù„Ù†Ø¸Ø§Ù… Ø¢Ù…Ù† - Ø§Ù„Ø·Ø§Ù„Ø¨: Ø£Ø­Ù…Ø¯
        </div>
        <div style="position: relative; margin-top: 20px;">
            <h3>Ø¬Ø±Ø¨ ØªØ¹Ù…Ù„ Zoom (Ctrl +) Ø£Ùˆ Ø¨ØµØ¨Ø§Ø¹Ùƒ:</h3>
            <p id="question-text">Ø¨Ù…Ø§ ØªÙØ³Ø±: Ù„Ù…Ø§Ø°Ø§ Ù„Ø§ ØªØ³ØªØ¬ÙŠØ¨ Ø§Ù„ØµÙØ­Ø© Ù„Ù„ØªÙƒØ¨ÙŠØ±ØŸ</p>
            <textarea id="answer-box" style="width: 100%; height: 150px; border: 2px solid #ddd; padding: 10px; font-size: 18px;" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©..."></textarea>
        </div>
    </div>

    <div id="warning-overlay">
        <h1>â›” Ù…Ø®Ø§Ù„ÙØ©!</h1>
        <h2 id="violation-reason" style="background: rgba(0,0,0,0.2); padding: 5px 15px;"></h2>
        <button class="btn-red" onclick="resumeExam()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
    </div>

    <script>
        // --- 1. Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… Ø¨Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ V7) ---
        document.addEventListener('keydown', function(event) {
            // Ù…Ù†Ø¹ Ctrl Ù…Ø¹ (+ Ø£Ùˆ - Ø£Ùˆ 0)
            if (event.ctrlKey && (event.key === '+' || event.key === '-' || event.key === '0' || event.key === '=')) {
                event.preventDefault();
                showToast("Ø§Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ± ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡");
            }
        });

        // Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… Ø¨Ø§Ù„Ø¨ÙƒØ±Ø© (Scroll Wheel) Ù…Ø¹ Ctrl
        document.addEventListener('wheel', function(event) {
            if (event.ctrlKey) {
                event.preventDefault();
                showToast("Ø§Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ± ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡");
            }
        }, { passive: false });


        // --- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ (ÙƒÙ…Ø§ Ù‡Ùˆ) ---
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('copy', e => { e.preventDefault(); showToast("Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù†Ø³Ø®!"); });
        document.addEventListener('cut', e => { e.preventDefault(); showToast("Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù‚Øµ!"); });
        document.addEventListener('paste', e => { e.preventDefault(); showToast("Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ù„ØµÙ‚!"); });
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'u' || e.key === 'a')) { e.preventDefault(); showToast("Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ø©"); }
            if (e.keyCode === 123) { e.preventDefault(); }
        });

        const startScreen = document.getElementById('start-screen');
        const examScreen = document.getElementById('exam-screen');
        const warningOverlay = document.getElementById('warning-overlay');
        const notifyBtn = document.getElementById('notifyBtn');
        const startBtn = document.getElementById('startBtn');
        const notifyStatus = document.getElementById('notifyStatus');
        const toast = document.getElementById('toast-notification');
        const watermarkContainer = document.querySelector('.watermark-container');
        let isExamActive = false;

        function generateWatermark() {
            watermarkContainer.innerHTML = ''; 
            for (let i = 0; i < 60; i++) {
                const item = document.createElement('div');
                item.classList.add('watermark-item');
                item.innerText = "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ - ID:12345";
                watermarkContainer.appendChild(item);
            }
        }
        generateWatermark();

        function showToast(msg) {
            toast.innerText = "âš ï¸ " + msg; toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }
        function requestNotifyPermission() {
            if (!("Notification" in window)) { alert("Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª"); return; }
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    notifyStatus.innerText = "ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ âœ…"; notifyStatus.style.color = "green";
                    notifyBtn.style.display = "none"; startBtn.style.display = "inline-block";
                } else { notifyStatus.innerText = "ØªÙ… Ø§Ù„Ø±ÙØ¶ âŒ"; notifyStatus.style.color = "red"; }
            });
        }
        function attemptStart() {
            // ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·: Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ù‡Ø§Ù…Ø´ Ø®Ø·Ø£ Ø£ÙƒØ¨Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ (0.85) Ù„Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù†Ø§Ø¯Ø±Ø©
            if (window.innerWidth < window.screen.width * 0.85) { alert("Ø£ØºÙ„Ù‚ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø´Ø§Ø´Ø©!"); return; }
            if (!document.hasFocus()) { alert("Ø£ØºÙ„Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©!"); return; }
            document.documentElement.requestFullscreen().then(() => {
                startScreen.style.display = 'none'; examScreen.style.display = 'block';
                isExamActive = true;
            }).catch(err => { alert("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©"); });
        }
        function resumeExam() {
            if (window.innerWidth < window.screen.width * 0.85) { alert("Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ù‚Ø³Ù…Ø©!"); return; }
            document.documentElement.requestFullscreen().then(() => {
                warningOverlay.style.display = 'none'; examScreen.style.display = 'block';
            });
        }
        function triggerViolation(reason) {
            if (!isExamActive) return;
            examScreen.style.display = 'none'; warningOverlay.style.display = 'flex';
            document.getElementById('violation-reason').innerText = reason; showToast(reason);
            if (Notification.permission === "granted") { try { if (navigator.vibrate) navigator.vibrate([200]); new Notification("Ù…Ø®Ø§Ù„ÙØ©: " + reason); } catch(e){} }
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨ Ù„Ù€ 0.85 Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹
        window.addEventListener('resize', () => { if (isExamActive && window.innerWidth < window.screen.width * 0.85) triggerViolation("ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø´Ø§Ø´Ø©"); });
        document.addEventListener('visibilitychange', () => { if (isExamActive && document.hidden) triggerViolation("Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"); });
        window.addEventListener('blur', () => { if (isExamActive) setTimeout(() => { if (!document.hasFocus()) triggerViolation("Ù„Ù…Ø³ Ø®Ø§Ø±Ø¬ÙŠ"); }, 200); });
        document.addEventListener('fullscreenchange', () => { if (isExamActive && !document.fullscreenElement) triggerViolation("Ø¥Ù„ØºØ§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©"); });
    </script>
</body>
</html>
